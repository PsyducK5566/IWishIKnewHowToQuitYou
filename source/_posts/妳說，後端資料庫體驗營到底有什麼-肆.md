---
title: 妳說，後端資料庫體驗營到底有什麼? 肆
date: 2024-11-28 00:15:52
tags: Practice
description: 那些練習是否會有什麼幫助？我不確定。
---

### 資料表與模擬資料
1.subject ：科目名稱
2.exam_score：科目成績
3.student：學生資料

<font color=#0000FF> ln [0]: </font>

```sql
-- 建立資料表
CREATE TABLE student (
 id serial PRIMARY KEY,
 name varchar(50) NOT NULL,
 class varchar(20) NOT NULL,
 created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE subject (
 id serial PRIMARY KEY,
 name varchar(50) NOT NULL,
 created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE exam_score (
 id serial PRIMARY KEY,
 student_id integer NOT NULL,
 subject_id integer NOT NULL,
 score integer NOT NULL,
 exam_date date NOT NULL,
 created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
 FOREIGN KEY (student_id) REFERENCES student(id),
 FOREIGN KEY (subject_id) REFERENCES subject(id)
);

-- 插入測試資料
INSERT INTO student (name, class) VALUES
('小明', '三年一班'),
('小華', '三年一班'),
('小美', '三年一班'),
('小龍', '三年一班'),
('小智', '三年一班');

INSERT INTO subject (name) VALUES
('國文'),
('英文'),
('數學');

INSERT INTO exam_score (student_id, subject_id, score, exam_date) VALUES
(1, 1, 85, '2024-03-01'),
(1, 2, 92, '2024-03-01'),
(1, 3, 78, '2024-03-01'),
(2, 1, 76, '2024-03-01'),
(2, 2, 88, '2024-03-01'),
(2, 3, 95, '2024-03-01'),
(3, 1, 92, '2024-03-01'),
(3, 2, 85, '2024-03-01'),
(3, 3, 87, '2024-03-01'),
(4, 1, 78, '2024-03-01'),
(4, 2, 82, '2024-03-01'),
(4, 3, 90, '2024-03-01'),
(5, 1, 88, '2024-03-01'),
(5, 2, 79, '2024-03-01'),
(5, 3, 93, '2024-03-01');
```
<font color=#FF0000> Out [0]:  </font>

![0](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241128%20Practice%2F0.png?alt=media&token=6fbefb20-01aa-4f4b-8cdf-246d392818a0)

這是一個完整的 SQL 多表結構，包含了 學生資料（student）、科目資料（subject） 和 考試成績（exam_score），並且插入了一些測試資料。

## 資料表結構
### 1. 學生資料表（student）
存放學生基本資訊，包括學生的 ID、姓名、班級 和建立時間。

```sql
CREATE TABLE student (
 id serial PRIMARY KEY,           -- 學生 ID
 name varchar(50) NOT NULL,       -- 學生姓名
 class varchar(20) NOT NULL,      -- 班級
 created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP -- 建立時間
);
```

### 2. 科目資料表（subject）
存放科目基本資訊，包括科目的 ID、名稱 和建立時間。

```sql
CREATE TABLE subject (
 id serial PRIMARY KEY,           -- 科目 ID
 name varchar(50) NOT NULL,       -- 科目名稱
 created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP -- 建立時間
);
```

### 3. 考試成績表（exam_score）
存放學生的考試成績，包括學生 ID 和科目 ID 的外鍵，還有成績、考試日期等。

```sql
CREATE TABLE exam_score (
 id serial PRIMARY KEY,           -- 成績記錄 ID
 student_id integer NOT NULL,     -- 學生 ID（外鍵）
 subject_id integer NOT NULL,     -- 科目 ID（外鍵）
 score integer NOT NULL,          -- 成績
 exam_date date NOT NULL,         -- 考試日期
 created_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, -- 建立時間
 FOREIGN KEY (student_id) REFERENCES student(id),         -- 關聯 student 表
 FOREIGN KEY (subject_id) REFERENCES subject(id)          -- 關聯 subject 表
);
```

## 測試資料
### 1. 學生資料（student）

```sql
INSERT INTO student (name, class) VALUES
('小明', '三年一班'),
('小華', '三年一班'),
('小美', '三年一班'),
('小龍', '三年一班'),
('小智', '三年一班');
```
### 2. 科目資料（subject）

```sql
INSERT INTO subject (name) VALUES
('國文'),
('英文'),
('數學');
```
### 3. 考試成績（exam_score）

```sql
INSERT INTO exam_score (student_id, subject_id, score, exam_date) VALUES
(1, 1, 85, '2024-03-01'), -- 小明 國文 85分
(1, 2, 92, '2024-03-01'), -- 小明 英文 92分
(1, 3, 78, '2024-03-01'), -- 小明 數學 78分
(2, 1, 76, '2024-03-01'), -- 小華 國文 76分
(2, 2, 88, '2024-03-01'), -- 小華 英文 88分
(2, 3, 95, '2024-03-01'), -- 小華 數學 95分
(3, 1, 92, '2024-03-01'), -- 小美 國文 92分
(3, 2, 85, '2024-03-01'), -- 小美 英文 85分
(3, 3, 87, '2024-03-01'), -- 小美 數學 87分
(4, 1, 78, '2024-03-01'), -- 小龍 國文 78分
(4, 2, 82, '2024-03-01'), -- 小龍 英文 82分
(4, 3, 90, '2024-03-01'), -- 小龍 數學 90分
(5, 1, 88, '2024-03-01'), -- 小智 國文 88分
(5, 2, 79, '2024-03-01'), -- 小智 英文 79分
(5, 3, 93, '2024-03-01'); -- 小智 數學 93分
```

**Q1 查詢所有科目**

<font color=#0000FF> ln [1]: </font>

```sql
SELECT * 
FROM subject;
```

<font color=#FF0000> Out [1]:  </font>

![1](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241128%20Practice%2F1.png?alt=media&token=1625a05c-4eab-4fa9-881a-cb0ea4a44e25)

>id：科目的唯一識別碼。
>name：科目的名稱（如國文、英文、數學）。
>created_at：該科目被新增到資料表的時間。

**Q2 計算所有成績平均**
要計算所有學生的成績平均分數，可以對 exam_score 資料表中的成績欄位（score）使用 SQL 的聚合函數 AVG 來計算。

<font color=#0000FF> ln [2]: </font>

```sql
SELECT AVG(score) AS average_score
FROM exam_score;
```

<font color=#FF0000> Out [2]:  </font>

![2](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241128%20Practice%2F2.png?alt=media&token=a30fa4c6-c257-4560-9c52-1c5d354a1546)

>AVG(score)：計算所有成績的平均值。
>AS average_score：將計算結果命名為 average_score。

#### 若需要更詳細的平均分數分析：

**科目計算平均分數**

<font color=#0000FF> ln [3]: </font>

```sql
SELECT 
    sub.name AS subject_name,
    AVG(e.score) AS average_score
FROM 
    exam_score e
JOIN 
    subject sub ON e.subject_id = sub.id
GROUP BY 
    sub.name;
```

<font color=#FF0000> Out [3]:  </font>

![2-1](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241128%20Practice%2F2-1.png?alt=media&token=c37a6ddf-ec53-4473-b883-bfc960bfd5ac)

**按學生計算平均分數**

<font color=#0000FF> ln [4]: </font>

```sql
SELECT 
    s.name AS student_name,
    AVG(e.score) AS average_score
FROM 
    exam_score e
JOIN 
    student s ON e.student_id = s.id
GROUP BY 
    s.name;
```

<font color=#FF0000> Out [4]:  </font>

![2-2](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241128%20Practice%2F2-2.png?alt=media&token=f513f5ab-025c-4733-85d8-3161bd0199ba)

**Q3 找出 90 分以上的成績**
要找出所有成績在 90 分以上 的資料，可以直接查詢 exam_score 資料表，並加上條件篩選 score > 90。

<font color=#0000FF> ln [5]: </font>

```sql
SELECT 
    e.id AS record_id,
    s.name AS student_name,
    sub.name AS subject_name,
    e.score AS score,
    e.exam_date AS exam_date
FROM 
    exam_score e
JOIN 
    student s ON e.student_id = s.id
JOIN 
    subject sub ON e.subject_id = sub.id
WHERE 
    e.score > 90;
```

<font color=#FF0000> Out [5]:  </font>

![3](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241128%20Practice%2F3.png?alt=media&token=07727f9a-9a97-4921-8881-e5af36c50838)

>e.score > 90：篩選所有成績大於 90 的資料。

><code>JOIN</code>：
>>student 表，用於獲取學生的姓名。
>>subject 表，用於獲取科目的名稱。

><code>AS</code>別名：將欄位命名為更易讀的名稱，例如 student_name 和 subject_name。

**Q4 顯示小明的國文成績，篩選條件請用國文的 subject_id = 1 進行篩選**

要查詢 小明的國文成績，可以根據以下條件進行篩選：
+ 學生姓名為「小明」。
+ 科目 ID 為 1（國文）。

<font color=#0000FF> ln [6]: </font>

```sql
SELECT 
    e.id AS record_id,
    s.name AS student_name,
    sub.name AS subject_name,
    e.score AS score,
    e.exam_date AS exam_date
FROM 
    exam_score e
JOIN 
    student s ON e.student_id = s.id
JOIN 
    subject sub ON e.subject_id = sub.id
WHERE 
    s.name = '小明' AND 
    sub.id = 1;
```

><code>s.name = '小明'</code>：篩選學生姓名為「小明」的記錄。
><code>sub.id = 1</code>：篩選科目 ID 為 1（國文）的記錄。

><code>JOIN</code>：
>>student 表：用於取得學生姓名。
>>subject 表：用於取得科目名稱。

**<code>JOIN</code> 的作用：**
```sql
JOIN student s ON e.student_id = s.id
```
+ student s：指定 student 表的別名為 s，這樣在查詢中可以用 s 來代表 student 表。
+ <code>ON</code> e.student_id = s.id：建立 exam_score 表（別名 e）和 student 表（別名 s）之間的連接條件：
    + exam_score 表的 student_id 欄位對應 student 表的 id 欄位。
    + 這樣每筆成績記錄都能找到對應的學生資料。

**s.name 的來源：**
+ 在 JOIN 之後，student 表的所有欄位（如 id, name, age, class）都可以被查詢使用。
+ s.name 就是從 student 表中選取的 name 欄位，表示學生的姓名。

#### 執行邏輯：

**exam_score 和 student 表的連接：**
+ exam_score.student_id = student.id，將成績表中的 student_id 對應到學生表中的 id，例如：
    + 成績記錄 student_id = 1 對應到 student.name = 小明。
    + 成績記錄 student_id = 2 對應到 student.name = 小華。

**exam_score 和 subject 表的連接：**
+ exam_score.subject_id = subject.id，將成績表中的 subject_id 對應到科目表中的 id，例如：
    + 成績記錄 subject_id = 101 對應到 subject.name = 國文。
    + 成績記錄 subject_id = 102 對應到 subject.name = 數學。



SEE YOU TOMORROW (σ′▽‵)′▽‵)σ

<font color=#c0c0c0> 結果或許並沒有多大用處，只不過是回憶而已也不一定。 </font>
 