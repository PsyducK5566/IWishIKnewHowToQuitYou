---
title: 你說, 後端資料庫體驗營到底有什麼? 壹
date: 2024-11-25 22:18:43
tags: Practice
description: 體驗營只有體驗營才有的東西
---
序

有一間廠商即將建置「健身教練線上直播課平台」
其優點是：
+ **小班制健身直播課制：**教練會在平台開課，學生前往教練開設的課程頁面報名，課程時間到了後，就可點擊課程直播室進行上課
+ 堂數售價：每位健身教練的收費都一致，一堂 50 分鐘**小班制健身直播課**都是 200 元

**堂數組合包方案**
+ 7 堂組合包方案：
    + 價格：1,400 元 
+ 14 堂方案：
    + 價格：2,520 元
+ 21 堂方案：
    + 價格：4,800 元  Σ(°Д°;

### 請先建立 users 資料表

<font color=#0000FF> ln [1]: </font>

```sql
CREATE TABLE "USER" (
  "id" uuid PRIMARY KEY NOT NULL DEFAULT (gen_random_uuid()),
  "name" varchar(50) NOT NULL,
  "email" varchar(320) UNIQUE NOT NULL,
  "role" varchar(20) NOT NULL, -- 角色，分別有 "USER"、"COACH"
  "created_at" timestamp NOT NULL DEFAULT (CURRENT_TIMESTAMP),
  "updated_at" timestamp NOT NULL DEFAULT (CURRENT_TIMESTAMP)
);
```
<font color=#FF0000> Out [1]:  </font>
![result](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241125%20Practice%2F1.png?alt=media&token=e777a077-1daa-46de-b002-9787280a2ee6)

id
>**資料型別：** <code>uuid</code>
>**功能：**作為每個使用者的唯一識別碼（主鍵）。
>**特性：**
>> <code>PRIMARY KEY</code>：此欄位是主鍵，保證每筆記錄的唯一性。
>> <code>NOT NULL</code>：
>> <code>DEFAULT (gen_random_uuid())</code>：自動生成一個隨機的 UUID 作為預設值，無需手動指定。

name
>**資料型別：** <code>varchar(50)</code>
>**功能：**儲存使用者的名稱。
>**特性：**
>><code>NOT NULL</code>：此欄位不得為空。
>>長度限制：最多 50 個字元。

email
>**資料型別：** <code>varchar(320)</code>
>**功能：**儲存使用者的電子郵件地址。
>**特性：**
>><code>UNIQUE</code>：此欄位的值需唯一，不能有重複的電子郵件。
>><code>NOT NULL</code>：此欄位不得為空。
>>**長度限制：**最多 320 個字元（符合電子郵件標準）。

role
>**資料型別：** <code>varchar(20)</code>
>**功能：**儲存使用者的角色類型。
>**特性：**
>>角色值：可選值為 "USER"（普通使用者）或 "COACH"（教練）
>><code>NOT NULL</code>：此欄位不得為空。

created_at
>**資料型別：** <code>timestamp</code>
>**功能：**記錄使用者的建立時間。
>**特性：**
>><code>NOT NULL</code>：此欄位不得為空。
>><code>DEFAULT (CURRENT_TIMESTAMP)</code>：自動填入當前的時間戳，表示記錄建立的時間。

updated_at
>**資料型別：** <code>timestamp</code>
>**功能：**記錄使用者的最後更新時間。
>**特性：**
>><code>NOT NULL</code>：此欄位不得為空。
>><code>DEFAULT (CURRENT_TIMESTAMP)</code>：自動填入當前的時間戳，表示記錄最後更新的時間。

### 功能與用途
#### 此表適用於管理系統中的使用者資料，提供以下功能：
1. 唯一的 id 用於識別每個使用者。
2. 儲存使用者的基本資訊（名稱與電子郵件）。
3. 區分使用者角色（普通使用者或教練）。
4. 自動記錄建立與更新時間，便於追蹤資料變更。

## 用戶資料，資料表為 USER
### <u>新增</u>六筆用戶資料，資料如下：
+ 用戶名稱為 李燕容，Email 為 lee2000@hexschooltest.io，Role 為 USER
+ 用戶名稱為 王小明，Email 為 wXlTq@hexschooltest.io，Role 為 USER
+ 用戶名稱為 肌肉棒子，Email 為 muscle@hexschooltest.io，Role 為 USER
+ 用戶名稱為 好野人，Email 為 richman@hexschooltest.io，Role 為 USER
+ 用戶名稱為 Q太郎，Email 為 starplatinum@hexschooltest.io，Role 為 USER
+ 用戶名稱為 透明人，Email 為 opacity0@hexschooltest.io，Role 為 USER

使用 INSERT INTO 語句將資料插入到 USER 資料表中：

<font color=#0000FF> ln [2]: </font>

```sql
INSERT INTO "USER" ("name", "email", "role")
VALUES
  ('李燕容', 'lee2000@hexschooltest.io', 'USER'),
  ('王小明', 'wXlTq@hexschooltest.io', 'USER'),
  ('肌肉棒子', 'muscle@hexschooltest.io', 'USER'),
  ('好野人', 'richman@hexschooltest.io', 'USER'),
  ('Q太郎', 'starplatinum@hexschooltest.io', 'USER'),
  ('透明人', 'opacity0@hexschooltest.io', 'USER');
```

<font color=#FF0000> Out [2]:  </font>
![result1](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241125%20Practice%2F2.png?alt=media&token=77d928a9-d52f-4b4f-89a8-5787c529de3e)

使用以下語句查看資料載入後的樣子：
<font color=#0000FF> ln [3]: </font>

```sql
SELECT*FROM "USER" ;
```
<font color=#FF0000> Out [3]:  </font>
![result1Table](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241125%20Practice%2F2-checkTable.png?alt=media&token=75baa3ba-8e72-458a-92b7-a89e4bc10f21)

>**欄位選擇：**
>>只插入 name（用戶名稱）、email（電子郵件）和 role（角色）。
>>id 會自動生成，因為設置了 <code>DEFAULT (gen_random_uuid())</code>。
>>created_at 和 updated_at 因 <code> DEFAULT (CURRENT_TIMESTAMP)</code> 會自動填入當前時間。

### 用 Email 找到 李燕容、肌肉棒子、Q太郎，如果他的 Role 為 USER 將他的 Role <u>修改</u>為 COACH
修改指定用戶的 SQL 語法，根據 email 找到符合條件的用戶，並將 role 從 USER 更新為 COACH：

<font color=#0000FF> ln [4]: </font>

```sql
UPDATE "USER"
SET "role" = 'COACH'
WHERE "email" IN ('lee2000@hexschooltest.io', 'muscle@hexschooltest.io', 'starplatinum@hexschooltest.io')
  AND "role" = 'USER';
```
<font color=#FF0000> Out [4]:  </font>
![result2](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241125%20Practice%2F3.png?alt=media&token=b6254611-6749-49c0-a9bc-1b689a5c2ce9)

> <code>UPDATE "USER"</code>：
>>指定要修改的資料表為 USER。

> <code>SET "role" = 'COACH'</code>：
>>將 role 欄位的值更新為 'COACH'。

> <code>WHERE </code>條件：
>>email 條件：只更新 email 為 lee2000@hexschooltest.io、muscle@hexschooltest.io 和 starplatinum@hexschooltest.io 的用戶。
>>role = 'USER' 條件：僅在 role 為 'USER' 的情況下進行更新，避免不必要的修改。

> <code>IN</code> 關鍵字：
>>用於匹配多個 email 值，簡化了多個 OR 條件的寫法。

**<font color=#FF0000> 注意事項 </font>**
>**條件檢查：**
>>如果用戶的 role 已經是 COACH，這條語句不會影響該資料（因為加了 <code>AND "role" = 'USER'</code> 的條件）。

>**安全性：**
>>確保 WHERE 條件正確，避免更新到不應該修改的資料。

檢查更新結果
可以使用以下語句來確認更新是否成功：

<font color=#0000FF> ln [5]: </font>

```sql
SELECT "name", "email", "role"
FROM "USER"
WHERE "email" IN ('lee2000@hexschooltest.io', 'muscle@hexschooltest.io', 'starplatinum@hexschooltest.io');
```
<font color=#FF0000> Out [5]:  </font>

![result2Table](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241125%20Practice%2F3-checkTable.png?alt=media&token=916b20a2-693e-4349-b49f-c8cd3869d61f)

### <u>刪除</u> USER 資料表中，用 Email 找到 透明人，並刪除該筆資料
刪除 USER 資料表中 透明人 資料的 SQL 語法，根據 email 找到並刪除該筆資料：

<font color=#0000FF> ln [6]: </font>

```sql
DELETE FROM "USER"
WHERE "email" = 'opacity0@hexschooltest.io';
```

<font color=#FF0000> Out [6]:  </font>

![result3](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241125%20Practice%2F4.png?alt=media&token=b70bdad0-853b-4dd2-acf8-346fc208f1bd)

>**<code> DELETE FROM "USER"</code>**:
>>指定要刪除資料的資料表為 USER。

>**<code>WHERE "email" = 'opacity0@hexschooltest.io'</code>**:
>>使用 WHERE 條件篩選出 email 為 opacity0@hexschooltest.io 的資料，確保只刪除符合條件的那一筆資料。

**<font color=#FF0000> 注意事項 </font>**
>**確認刪除條件：**
>>確保 email 條件正確，避免刪除錯誤的資料。

>**不可逆操作：**
>> <code>DELETE</code>操作是不可逆的，刪除後無法恢復。

可以執行以下查詢語句，確認資料是否已成功刪除：

<font color=#0000FF> ln [7]: </font>

```sql
SELECT * FROM "USER" WHERE "email" = 'opacity0@hexschooltest.io';
```
<font color=#FF0000> Out [7]:  </font>
![result3Table](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241125%20Practice%2F4-checkTable.png?alt=media&token=dddb56ed-efa9-4ce8-a719-e6a9a19edb6a)

查詢結果為空，表示刪除成功。

### <u>查詢</u>取得 USER 資料表目前所有用戶數量（提示：使用count函式）
查詢 USER 資料表中目前用戶數量的 SQL 語法：

<font color=#0000FF> ln [8]: </font>

```sql
SELECT COUNT(*) AS user_count
FROM "USER";
```

<font color=#FF0000> Out [8]:  </font>
![result4](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241125%20Practice%2F5.png?alt=media&token=663c2239-3a01-46a5-9b0c-689766b6eb0b)

>**<code>SELECT COUNT(*)</code>:**
>>使用 COUNT(*) 函數計算資料表中所有資料列的數量。

>**<code>AS user_count</code>：**
>>將計算結果命名為 user_count，方便識別結果欄位。

>**<code>FROM "USER"</code>:**
>>指定要查詢的資料表為 USER。

### <u>查詢</u>取得 USER 資料表所有用戶資料，並列出前 3 筆（提示：使用limit語法）
以下是查詢 USER 資料表中所有用戶資料並列出前 3 筆的 SQL 語法：

<font color=#0000FF> ln [9]: </font>

```sql
SELECT *
FROM "USER"
LIMIT 3;
```

執行上述語句後，會返回 USER 資料表中的前 3 筆資料，例如：

<font color=#FF0000> Out [9]:  </font>
![result5](https://firebasestorage.googleapis.com/v0/b/pictureforu-3b8e9.appspot.com/o/SQL%20%3A%2020241125%20Practice%2F6.png?alt=media&token=42a87d64-89e9-4de4-bad6-b317804cad2e)

><code>SELECT *</code>:
>>選取 USER 資料表中的所有欄位。

>**<code>FROM "USER"</code>:**
>>指定要查詢的資料表為 USER。

>**<code>LIMIT 3</code>:**
>>限制查詢結果只返回前 3 筆資料。

>**檢查資料完整性：**
>>如果資料表中有重複資料或需要特定篩選，可以加上 WHERE 條件進一步過濾。

## 額外知識補充

1. 下方的 <code>created_at</code>、 <code>updated_at</code> 的  <code>DEFAULT</code> 是預設值意思，若是在建立資料時沒填寫的話不會報錯，而是會能放預設值
2. 下方的建立資料表，會需要用雙引號<code>"USER"</code>原因是，***postgreSQL 的 user 是關鍵字***，為了避免撞名所以需要加上雙引號
3. 在選取資料表時， 也請留意要加上雙引號，例如 <code>SELECT * FROM "USER"</code>
4. <code>timestamp</code>也是一種資料格式(Data Type)，主要是「時間格式」，範例為 2024-11-24T17:42:04.452Z

SEE YOU TOMORROW (σ′▽‵)′▽‵)σ